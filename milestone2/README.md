#DevOps - Milestone 2


#TEST + ANALYSIS Stage

Repository: We have used an existing GitHub repository which is Homework 2 in DevOps (built with Node.js). This is the [original repo](https://github.ncsu.edu/pvichar/HW2.git)



###TOOLS and PLUGINS
* NodeJS plugin for Jenkins
* Mocha: JavaScript test framework
* JSHint: Give static errors like missing semicolom, function library not imported, etc.
* Cobertura: Plugin to generate a Coverage report for the entire job and each build that is triggered in Jenkins
* CheckStyle: Plugin to publish static analysis' warnings and errors in Jenkins.
* Istanbul: Code Coverage tool


###Setup

* Clone the original repo to local git repository on your local machine
* Make sure you have all the dependencies on your system as specified by package.json
* Install the NodeJS, CheckStyle, Cobertura plugins in Jenkins


#TEST

We have created two jobs to show the improvement in code coverage. Each of these jobs use the same source code.  
The BasicTest job will run only the developer written unit tests present in test_project.js when a build is triggered on a git push. 
The AdvancedTest job will invoke main.js file to generate additional unit tests on the source code and execute them for additional coverage. 

**Note**: The source code contains only the developer written unit tests. The advanced testing feature is automatically invoked in our pipeline


###Task 1: Test Suites - Basic Testing

* The BasicTest job executes the developer written unit tests using the Mocha framework
* Once the tests are run Istanbul will collect the code coverage report and then push it to Cobertura which generates the coverage report for metrics such as packages, classes, lines, conditionals
* jshint also runs to perform a static analysis and its report is published by the CheckStyle plugin

![img](https://github.ncsu.edu/jhjain/DevOps---M2/blob/master/basictest.png)


###Task 2: Advanced Testing

* The AdvancedTest job executes the developer written tests and also the tests generated by main.js using Esprima
* These tests provide a better code coverage as can be seen by the Cobertura report
* main.js uses esprima and then parses over it to generate test cases in a file test.js
* This occurs as a part of the build and is specified in the job configuration


![img](https://github.ncsu.edu/jhjain/DevOps---M2/blob/master/advancedtest.png)


#ANALYSIS

###Task 3: Static Analysis

* We have used the JSHint javascript tool to perform static analysis on our source code
* This tool check the source files for elements like missing semi colon, operators, unused variables etc.
* If the number of errors in the static analyis are more than a permissible limit we can fail the build
* The out of the report generated by JSHint is directed to the CheckStyle XML plugin which then displays it in a graphical form


![img](https://github.ncsu.edu/jhjain/DevOps---M2/blob/master/jshint.png)


###Task 4: Extended Analysis

* For extended statis analysis we have have used the comments to code ratio metric
* We have written a script in python, comment_to_code.py which traverses the entire source code directory and computes the comment to code ratio
* We can set a permissible limit for our code quality in which case if the comment to code ratio does not meet the limit it will fail the build
* The python script is invoked at the start of our build process

![img](https://github.ncsu.edu/jhjain/DevOps---M2/blob/master/cc.png)


#GATES

###Task 5 and 6: Custom Metrics and Gates

* We have implemented a custom metric that our repo should not contain any rsa, .pem or Digital Ocean tokens in the code
* To enable this we have a script security.py which searches our code repository for any security tokens or keys
* This script is run via a pre-commit hook in our local repository which acts like a gate
* It looks through the file names and also the contents of the files in the source directory
* If any file is found to have a key, the code commit is failed

![img](https://github.ncsu.edu/jhjain/DevOps---M2/blob/master/gates.png)




###Screencast Link 

[Screencast of Milestone 2](https://drive.google.com/open?id=0B4QmUm8JkAl8Z09RX1FWX1JnNlU)








